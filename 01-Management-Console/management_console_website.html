<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartPMO.ai Operations Console</title>
    <!-- Big warm favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='20' y='30' width='30' height='10' rx='3' fill='%23ff4444'/%3E%3Crect x='20' y='50' width='45' height='10' rx='3' fill='%23ff8800'/%3E%3Crect x='20' y='70' width='25' height='10' rx='3' fill='%23ffcc00'/%3E%3Ccircle cx='15' cy='35' r='5' fill='%23ff4444'/%3E%3Ccircle cx='15' cy='55' r='5' fill='%23ff8800'/%3E%3Ccircle cx='15' cy='75' r='5' fill='%23ffcc00'/%3E%3C/svg%3E">
    <style>
        :root{--bg-dark:#1a1a1a;--bg-card:#1e1e1e;--bg-panel:#2a2a2a;--text-light:#e0e0e0;--accent-red:#ff4444;--accent-orange:#ff8800;--accent-yellow:#ffcc00;--border-radius:8px;--gap:16px}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:var(--bg-dark);color:var(--text-light);padding-top:70px}
        #heroBar{position:fixed;top:0;left:0;right:0;height:60px;background:var(--bg-panel);display:flex;align-items:center;padding:0 20px;z-index:1000;border-bottom:2px solid var(--accent-orange)}
        #heroBar svg{height:36px;margin-right:10px}#heroBar h1{font-size:20px;color:var(--accent-yellow)}
        #liveClock{margin-left:auto;font-size:14px;color:var(--accent-orange)}
        .status-pill{padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase;margin-left:12px}
        .status-pill.connected{background:#44ff44;color:#000}.status-pill.error{background:var(--accent-red);color:#fff}
        nav{background:var(--bg-panel);padding:10px 20px;display:flex;gap:10px;border-radius:var(--border-radius);margin:0 20px 20px}
        nav button{background:var(--accent-red);color:#fff;border:none;padding:8px 16px;border-radius:var(--border-radius);cursor:pointer;font-weight:600;transition:background .2s}
        nav button:hover{background:var(--accent-orange)}nav button.active{background:var(--accent-yellow);color:#000}
        .page{display:none;padding:0 20px 20px}.page.active{display:block}h2{margin:10px 0;color:var(--accent-orange);font-size:18px}

        /* ----------Grid-Cards Manual Updates---------- */
        .manual-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--gap);margin:0 20px}
        .manual-card{background:var(--bg-panel);border-radius:var(--border-radius);padding:20px;display:flex;flex-direction:column;border-left:6px solid var(--accent-red)}
        .manual-card.daily{border-left-color:var(--accent-red)}.manual-card.weekly{border-left-color:var(--accent-orange)}.manual-card.docs{border-left-color:var(--accent-yellow)}
        .manual-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
        .manual-header span{font-size:20px}.manual-header h3{color:var(--accent-yellow);font-size:17px}
        .manual-list{display:flex;flex-direction:column;gap:8px}
        .manual-item{display:flex;align-items:flex-start;gap:10px;padding:6px 0;border-bottom:1px solid #333}
        .manual-item:last-child{border-bottom:none}
        .manual-item input[type=checkbox]{accent-color:var(--accent-orange);width:18px;height:18px;margin-top:2px}
        .manual-item label{font-size:14px;line-height:1.4;padding-left:0;text-align:left;cursor:pointer}

        /* ----------Other sections (unchanged)---------- */
        #addTaskWrap{background:var(--bg-panel);border-radius:var(--border-radius);margin:0 20px 20px;overflow:hidden}
        #addTaskHeader{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:var(--accent-red);cursor:pointer}
        #addTaskHeader h2{margin:0;font-size:16px}#addTaskChevron{font-size:12px}
        #addTaskContent{max-height:0;transition:max-height .3s ease;overflow:hidden}#addTaskContent.open{max-height:500px}
        .add-form{padding:15px}.form-group{margin-bottom:10px}label{display:block;margin-bottom:4px;color:var(--accent-orange);font-weight:600}
        input,select,textarea{width:100%;padding:8px;background:var(--bg-card);border:1px solid #444;border-radius:var(--border-radius);color:var(--text-light)}
        button[type=submit]{background:var(--accent-orange);color:#fff;border:none;padding:10px 20px;border-radius:var(--border-radius);cursor:pointer;font-weight:600;margin-top:6px}
        .filters{display:flex;flex-wrap:wrap;gap:20px;margin:0 20px 20px}.filter-group{background:var(--bg-panel);padding:10px 15px;border-radius:var(--border-radius)}
        .filter-group h3{color:var(--accent-yellow);font-size:15px;margin-bottom:6px}.filter-group label{display:flex;align-items:center;gap:6px;margin:4px 0;font-size:14px}
        .filter-group input[type=checkbox]{width:16px;height:16px;accent-color:var(--accent-orange)}
        .filter-buttons{display:flex;gap:6px;margin-top:6px}.filter-buttons button{background:var(--accent-yellow);color:#000;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px}
        .kanban{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:var(--gap);margin:0 20px}
        .column{background:var(--bg-panel);border-radius:var(--border-radius);padding:12px}
        .column-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.column h3{color:var(--accent-yellow);font-size:16px}
        .count-pill{background:var(--accent-red);color:#fff;font-size:11px;padding:2px 8px;border-radius:10px}
        .card{background:var(--bg-card);border-left:4px solid var(--accent-red);padding:10px;margin-bottom:10px;border-radius:var(--border-radius);cursor:pointer;position:relative;animation:fadeIn .3s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .card.critical{border-left-color:#ff0044}.card.high{border-left-color:var(--accent-red)}.card.medium{border-left-color:var(--accent-orange)}.card.low{border-left-color:var(--accent-yellow)}
        .card-title{font-weight:600;margin-bottom:4px}.card-meta{font-size:12px;color:#aaa;display:flex;justify-content:space-between}
        .card-actions{position:absolute;top:4px;right:4px;display:none;gap:4px}.card:hover .card-actions{display:flex}
        .card-actions button{background:var(--accent-orange);color:#fff;border:none;padding:2px 6px;border-radius:4px;cursor:pointer;font-size:11px}
        .log-table{background:var(--bg-panel);border-radius:var(--border-radius);padding:15px;margin:0 20px;overflow-x:auto}
        table{width:100%;border-collapse:collapse}th{text-align:left;padding:10px;border-bottom:2px solid var(--accent-orange);color:var(--accent-orange)}
        td{padding:10px;border-bottom:1px solid #333}.status-success{color:#44ff44}.status-failed{color:var(--accent-red)}.status-warning{color:var(--accent-yellow)}
    </style>
</head>
<body>

<!-- Hero Bar -->
<div id="heroBar">
    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none">
        <rect x="4" y="6" width="8" height="2" rx="1" fill="var(--accent-red)"/>
        <rect x="4" y="10" width="12" height="2" rx="1" fill="var(--accent-orange)"/>
        <rect x="4" y="14" width="6" height="2" rx="1" fill="var(--accent-yellow)"/>
        <circle cx="3" cy="7" r="1.5" fill="var(--accent-red)"/>
        <circle cx="3" cy="11" r="1.5" fill="var(--accent-orange)"/>
        <circle cx="3" cy="15" r="1.5" fill="var(--accent-yellow)"/>
        <g transform="translate(13,7) scale(0.7)"><path d="M0 -3 Q1 -1 3 0 Q1 1 0 3 Q-1 1 -3 0 Q-1 -1 0 -3 Z" fill="var(--accent-yellow)"/><path d="M0 -2 Q0.7 -0.7 2 0 Q0.7 0.7 0 2 Q-0.7 0.7 -2 0 Q-0.7 -0.7 0 -2 Z" fill="#ffffff" opacity="0.8"/><path d="M0 -1.2 Q0.4 -0.4 1.2 0 Q0.4 0.4 0 1.2 Q-0.4 0.4 -1.2 0 Q-0.4 -0.4 0 -1.2 Z" fill="var(--accent-red)"/></g>
        <g transform="translate(17,11) scale(1.3)"><path d="M0 -3 Q1 -1 3 0 Q1 1 0 3 Q-1 1 -3 0 Q-1 -1 0 -3 Z" fill="var(--accent-yellow)"/><path d="M0 -2 Q0.7 -0.7 2 0 Q0.7 0.7 0 2 Q-0.7 0.7 -2 0 Q-0.7 -0.7 0 -2 Z" fill="#ffffff" opacity="0.8"/><path d="M0 -1.2 Q0.4 -0.4 1.2 0 Q0.4 0.4 0 1.2 Q-0.4 0.4 -1.2 0 Q-0.4 -0.4 0 -1.2 Z" fill="var(--accent-orange)"/></g>
        <g transform="translate(11,15) scale(1.0)"><path d="M0 -3 Q1 -1 3 0 Q1 1 0 3 Q-1 1 -3 0 Q-1 -1 0 -3 Z" fill="#ffffff"/><path d="M0 -2 Q0.7 -0.7 2 0 Q0.7 0.7 0 2 Q-0.7 0.7 -2 0 Q-0.7 -0.7 0 -2 Z" fill="var(--accent-yellow)" opacity="0.9"/><path d="M0 -1.2 Q0.4 -0.4 1.2 0 Q0.4 0.4 0 1.2 Q-0.4 0.4 -1.2 0 Q-0.4 -0.4 0 -1.2 Z" fill="var(--accent-red)"/></g>
    </svg>
    <h1>SmartPMO.ai Operations Console</h1>
    <div id="liveClock"></div>
    <span id="dbStatus" class="status-pill connected">Connected</span>
</div>

<nav>
    <button class="active" onclick="showPage('backlog')">Backlog</button>
    <button onclick="showPage('operations')">Operations</button>
    <button onclick="showPage('manual')">Manual Updates</button>
    <button onclick="showPage('restart')">Restart Prompts</button>
</nav>

<!-- ----------BACKLOG (with IDs restored) ---------- -->
<div id="backlog" class="page active">
    <div id="addTaskWrap">
        <div id="addTaskHeader" onclick="toggleAddTask()">
            <h2>Ôºã Add New Task</h2>
            <span id="addTaskChevron">‚ñº</span>
        </div>
        <div id="addTaskContent">
            <form class="add-form" id="addTaskForm" onsubmit="submitTask(event)">
                <div class="form-group"><label>Title</label><input type="text" id="taskTitle" required></div>
                <div class="form-group"><label>Description</label><textarea id="taskDesc"></textarea></div>
                <div class="form-group"><label>Category</label>
                    <select id="taskCategory">
                        <option value="website">Website</option>
                        <option value="prompts">Prompts</option>
                        <option value="discovery-engine">Discovery Engine</option>
                        <option value="newsletter-engine">Newsletter Engine</option>
                        <option value="analysis-engine">Analysis Engine</option>
                        <option value="database">Database</option>
                        <option value="automation">Automation</option>
                        <option value="deployment">Deployment</option>
                        <option value="general">General</option>
                    </select>
                </div>
                <div class="form-group"><label>Priority</label>
                    <select id="taskPriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <button type="submit">Add Task</button>
            </form>
        </div>
    </div>

    <div class="filters">
        <div class="filter-group">
            <h3>Priority</h3>
            <label><input type="checkbox" class="filter-priority" value="critical" checked> Critical</label>
            <label><input type="checkbox" class="filter-priority" value="high" checked> High</label>
            <label><input type="checkbox" class="filter-priority" value="medium" checked> Medium</label>
            <label><input type="checkbox" class="filter-priority" value="low" checked> Low</label>
            <div class="filter-buttons"><button onclick="selectAll('filter-priority',true)">All</button><button onclick="selectAll('filter-priority',false)">None</button></div>
        </div>
        <div class="filter-group">
            <h3>Category</h3>
            <label><input type="checkbox" class="filter-category" value="website" checked> Website</label>
            <label><input type="checkbox" class="filter-category" value="prompts" checked> Prompts</label>
            <label><input type="checkbox" class="filter-category" value="discovery-engine" checked> Discovery Engine</label>
            <label><input type="checkbox" class="filter-category" value="newsletter-engine" checked> Newsletter Engine</label>
            <label><input type="checkbox" class="filter-category" value="analysis-engine" checked> Analysis Engine</label>
            <label><input type="checkbox" class="filter-category" value="database" checked> Database</label>
            <label><input type="checkbox" class="filter-category" value="automation" checked> Automation</label>
            <label><input type="checkbox" class="filter-category" value="deployment" checked> Deployment</label>
            <label><input type="checkbox" class="filter-category" value="general" checked> General</label>
            <div class="filter-buttons"><button onclick="selectAll('filter-category',true)">All</button><button onclick="selectAll('filter-category',false)">None</button></div>
        </div>
    </div>

    <div class="kanban" id="kanban">
        <div class="column">
            <div class="column-header"><h3>üìã To Do</h3><span class="count-pill">0</span></div>
            <div id="todo" class="cards"></div>
        </div>
        <div class="column">
            <div class="column-header"><h3>‚ö° In Progress</h3><span class="count-pill">0</span></div>
            <div id="in-progress" class="cards"></div>
        </div>
        <div class="column">
            <div class="column-header"><h3>üöß Blocked</h3><span class="count-pill">0</span></div>
            <div id="blocked" class="cards"></div>
        </div>
        <div class="column">
            <div class="column-header"><h3>‚úÖ Done</h3><span class="count-pill">0</span></div>
            <div id="done" class="cards"></div>
        </div>
    </div>
</div>

<!-- ----------OPERATIONS---------- -->
<div id="operations" class="page">
    <h2>Operations Dashboard</h2>
    <button class="refresh-btn" onclick="loadOperations()">üîÑ Refresh</button>
    <div class="ops-summary" id="opsSummary"></div>
    <h2>Recent Operations (Last 24h)</h2>
    <div class="log-table">
        <table id="opsTable">
            <thead><tr>
                <th>Date</th><th>Time</th><th>Operation</th><th>Component</th><th>Status</th><th>Message</th><th>Records</th><th>Duration</th>
            </tr></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- ----------MANUAL UPDATES ‚Äì GRID CARDS---------- -->
<div id="manual" class="page">
    <h2>Manual Updates Checklist</h2>
    <div class="manual-grid">
        <!-- Daily Card -->
        <div class="manual-card daily">
            <div class="manual-header"><span>üìÖ</span><h3>Daily Tasks</h3></div>
            <div class="manual-list">
                <div class="manual-item"><input type="checkbox"><label>Run scoring prompt on new articles</label></div>
                <div class="manual-item"><input type="checkbox"><label>Generate newsletter cards (v2.1)</label></div>
                <div class="manual-item"><input type="checkbox"><label>Update daily-cards.json</label></div>
                <div class="manual-item"><input type="checkbox"><label>Verify website refresh</label></div>
                <div class="manual-item"><input type="checkbox"><label>Check operations log for errors</label></div>
            </div>
        </div>

        <!-- Weekly Card -->
        <div class="manual-card weekly">
            <div class="manual-header"><span>üìÜ</span><h3>Weekly Tasks</h3></div>
            <div class="manual-list">
                <div class="manual-item"><input type="checkbox"><label>Review backlog priorities</label></div>
                <div class="manual-item"><input type="checkbox"><label>Database backup verification</label></div>
                <div class="manual-item"><input type="checkbox"><label>Website analytics review</label></div>
                <div class="manual-item"><input type="checkbox"><label>Clear old operations logs (&gt;30 days)</label></div>
            </div>
        </div>

        <!-- Documentation Card -->
        <div class="manual-card docs">
            <div class="manual-header"><span>üìù</span><h3>Documentation</h3></div>
            <div class="manual-list">
                <div class="manual-item"><input type="checkbox"><label>Update restart prompt in database</label></div>
                <div class="manual-item"><input type="checkbox"><label>Document prompt version changes</label></div>
                <div class="manual-item"><input type="checkbox"><label>Update backlog completion notes</label></div>
            </div>
        </div>
    </div>
</div>

<!-- ----------RESTART PROMPTS---------- -->
<div id="restart" class="page">
    <h2>üîÑ Chat Restart Prompts</h2>
    <p style="color:#aaa;margin-bottom:20px">Use these prompts to end/start Claude chat sessions with full context preservation.</p>
    <div style="background:var(--bg-panel);padding:20px;border-radius:var(--border-radius)">
        <h3>üöÄ Quick Start (Daily)</h3>
        <div style="background:var(--bg-card);padding:15px;border-left:4px solid var(--accent-yellow);font-family:monospace;font-size:13px;white-space:pre-wrap;margin-bottom:15px">Load my SmartPMO.ai project context and continue where we left off.

Use MCP to run these queries:
1. Get restart context:
SELECT content FROM restart_prompts WHERE prompt_type='quick' AND is_active=1;

2. Get recent session summary:
SELECT chat_date, summary, tasks_pending, context_notes 
FROM chat_history ORDER BY chat_date DESC, session_number DESC LIMIT 1;

3. Get top 5 backlog priorities:
SELECT id, title, priority, status FROM backlog 
WHERE status IN ('todo', 'in-progress')
ORDER BY CASE priority WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 END 
LIMIT 5;

Read all results and tell me what we're working on today.</div>
        <button onclick="copyToClipboard(this.previousElementSibling.textContent)" style="background:var(--accent-yellow);color:#000;border:none;padding:10px 20px;border-radius:var(--border-radius);cursor:pointer;font-weight:600;width:100%">üìã Copy Quick Start Prompt</button>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:8080/api';
    /* ----------Hero---------- */
    function updateClock(){document.getElementById('liveClock').textContent=new Date().toLocaleTimeString()}
    setInterval(updateClock,1000);updateClock();
    /* ----------Collapsible Add Task---------- */
    function toggleAddTask(){
        const content=document.getElementById('addTaskContent');
        const chevron=document.getElementById('addTaskChevron');
        const isOpen=content.classList.toggle('open');
        chevron.textContent=isOpen?'‚ñ≤':'‚ñº';content.style.maxHeight=isOpen?content.scrollHeight+'px':'0';
    }
    function submitTask(e){
        e.preventDefault();
        const task={title:document.getElementById('taskTitle').value,description:document.getElementById('taskDesc').value,category:document.getElementById('taskCategory').value,priority:document.getElementById('taskPriority').value};
        fetch(`${API_URL}/backlog`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(task)})
         .then(r=>{if(r.ok){loadBacklog();toggleAddTask();}else alert('Add failed')});
    }
    /* ----------Connection---------- */
    async function checkConnection(){
        const el=document.getElementById('dbStatus');
        try{const r=await fetch(`${API_URL}/backlog`);if(r.ok){el.textContent='Connected';el.className='status-pill connected';return true}else throw new Error}catch(e){el.textContent='Error';el.className='status-pill error';return false}
    }
    /* ----------Nav---------- */
    function showPage(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));document.getElementById(id).classList.add('active');if(event)event.target.classList.add('active');if(id==='backlog')loadBacklog();if(id==='operations')loadOperations()}
    /* ----------Filters---------- */
    function saveFilters(){const pri=Array.from(document.querySelectorAll('.filter-priority:checked')).map(c=>c.value);const cat=Array.from(document.querySelectorAll('.filter-category:checked')).map(c=>c.value);localStorage.setItem('pmoFilters',JSON.stringify({pri,cat}))}
    function loadFilters(){const raw=localStorage.getItem('pmoFilters');const fallback={pri:['critical','high','medium','low'],cat:['website','prompts','discovery-engine','newsletter-engine','analysis-engine','database','automation','deployment','general']};const saved=raw?JSON.parse(raw):fallback;document.querySelectorAll('.filter-priority').forEach(c=>c.checked=saved.pri.includes(c.value));document.querySelectorAll('.filter-category').forEach(c=>c.checked=saved.cat.includes(c.value))}
    function selectAll(cls,on){document.querySelectorAll('.'+cls).forEach(c=>c.checked=on);filterTasks();saveFilters()}
    function filterTasks(){const allowedPri=Array.from(document.querySelectorAll('.filter-priority:checked')).map(c=>c.value);const allowedCat=Array.from(document.querySelectorAll('.filter-category:checked')).map(c=>c.value);if(document.querySelectorAll('.card').length===0)return;document.querySelectorAll('.card').forEach(card=>{const pri=card.dataset.priority;const cat=card.dataset.category;card.style.display=(allowedPri.includes(pri)&&allowedCat.includes(cat))?'block':'none'});updateColumnCounts();saveFilters()}
    function updateColumnCounts(){document.querySelectorAll('.column').forEach(col=>{const visible=col.querySelectorAll('.card:not([style*="display: none"])').length;col.querySelector('.count-pill').textContent=visible;})}
    document.querySelectorAll('.filter-priority, .filter-category').forEach(cb=>cb.addEventListener('change',filterTasks));
    /* ----------Kanban---------- */
    async function loadBacklog(){
        if(!await checkConnection())return;
        const r=await fetch(`${API_URL}/backlog`);
        const data=await r.json();
        const tasks=data.tasks||[];
        ['todo','in-progress','blocked','done'].forEach(c=>document.getElementById(c).innerHTML='');
        tasks.forEach((task,idx)=>{
            const card=document.createElement('div');
            card.className=`card ${task.priority}`;
            card.dataset.priority=task.priority;
            card.dataset.category=task.category;
            card.innerHTML=`<div class="card-actions"><button onclick="quickEdit(${task.id},'${task.title.replace(/'/g,"\\'")}',event)">‚úèÔ∏è</button><button onclick="deleteTask(${task.id},event)">üóëÔ∏è</button></div><div class="card-title">${task.title}</div><div class="card-meta"><span>${task.category}</span><span>${task.priority}</span></div>`;
            card.onclick=e=>{if(!e.target.matches('button'))updateTaskStatus(task.id,task.title)};
            document.getElementById(task.status).appendChild(card);
            card.style.animationDelay=(idx*50)+'ms';
        });
        filterTasks();updateColumnCounts();
    }
    async function updateTaskStatus(taskId,taskTitle){
        const input=prompt(`Update status for "${taskTitle}":\n1=todo\n2=in-progress\n3=blocked\n4=done`);
        if(!input)return;const map={1:'todo',2:'in-progress',3:'blocked',4:'done'};
        const status=map[input]||input.toLowerCase();
        if(!['todo','in-progress','blocked','done'].includes(status))return;
        const r=await fetch(`${API_URL}/backlog/${taskId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({status})});
        if(r.ok){loadBacklog();if(status==='done')confetti(document.getElementById('done'));}
    }
    async function deleteTask(taskId,e){
        e.stopPropagation();
        if(!confirm('Delete task?'))return;
        const r=await fetch(`${API_URL}/backlog/${taskId}`,{method:'DELETE'});
        if(r.ok)loadBacklog();
    }
    function confetti(column){
        const colors=['var(--accent-yellow)','var(--accent-orange)','var(--accent-red)'];
        for(let i=0;i<30;i++){
            const c=document.createElement('div');c.className='confetti';
            c.style.left=Math.random()*column.offsetWidth+'px';
            c.style.background=colors[Math.floor(Math.random()*colors.length)];
            c.style.animationDelay=Math.random()*0.3+'s';
            column.appendChild(c);
            setTimeout(()=>c.remove(),1000);
        }
    }
    /* ----------Operations---------- */
    async function loadOperations(){
        const statsRes=await fetch(`${API_URL}/operations/stats`);
        const stats=await statsRes.json();
        const summary=document.getElementById('opsSummary');
        summary.innerHTML=`
            <div class="stat-card"><div class="stat-value">${stats.total}</div><div class="stat-label">Ops (24h)</div></div>
            <div class="stat-card"><div class="stat-value">${stats.successRate}%</div><div class="stat-label">Success</div></div>
            <div class="stat-card"><div class="stat-value">${stats.failed}</div><div class="stat-label">Errors</div></div>
            <div class="stat-card"><div class="stat-value">${stats.avgDuration}s</div><div class="stat-label">Avg Dur</div></div>
        `;
        const opsRes=await fetch(`${API_URL}/operations`);
        const opsData=await opsRes.json();
        const ops=opsData.operations||[];
        const tbody=document.querySelector('#opsTable tbody');
        tbody.innerHTML=ops.map(op=>{
            const d=new Date(op.timestamp);
            return`<tr>
                <td>${d.toLocaleDateString()}</td>
                <td>${d.toLocaleTimeString()}</td>
                <td>${op.operation_type}</td>
                <td>${op.component}</td>
                <td class="status-${op.status}">${op.status}</td>
                <td>${op.message||'-'}</td>
                <td>${op.records_processed||'-'}</td>
                <td>${op.execution_time_seconds?op.execution_time_seconds+'s':'-'}</td>
            </tr>`;
        }).join('');
    }
    /* ----------Init---------- */
    (async()=>{
        loadFilters();
        const connected=await checkConnection();
        if(connected){loadBacklog();loadOperations();}
        setInterval(checkConnection,10000);
        setInterval(updateClock,1000);
    })();
</script>
</body>
</html>